/**
 * @fileoverview 游戏业务逻辑规则
 *
 * 【职责】
 * - 境界系统规则
 * - 三千大道体系规则
 * - 玩家意图与判定系统
 * - NPC相关规则
 * - NSFW内容生成规则
 *
 * 【设计原则】
 * - 游戏玩法相关
 * - 业务逻辑约束
 * - 内容生成规范
 */

export const REALM_SYSTEM_RULES = `
# 规则：境界与阶段

**境界顺序**：凡人 → 炼气 → 筑基 → 金丹 → 元婴 → 化神 → 炼虚 → 合体 → 渡劫
**阶段划分**：初期、中期、后期、圆满、极境(罕见)

## 突破经验标准（必须遵守）

**小阶段突破**：初期→中期(基础×1)、中期→后期(×2)、后期→圆满(×3)、圆满→极境(×10)

**各境界基础值**：炼气1000、筑基5000、金丹20000、元婴100000、化神500000、炼虚2000000、合体10000000、渡劫50000000

**大境界突破**：炼气→筑基10000、筑基→金丹50000、金丹→元婴200000、元婴→化神1000000、化神→炼虚5000000、炼虚→合体20000000、合体→渡劫100000000

## 重要规则
- 突破到新阶段时"当前进度"重置为0
- 大境界突破必须同时增加气血、灵气、神识上限
- 极境突破需特殊机缘
`.trim()

export const REALM_SUPPRESSION_RULES = `
# 规则：境界压制与战力法则（🔴 最高优先级）

## 境界压制铁律

**境界顺序**：凡人 → 炼气 → 筑基 → 金丹 → 元婴 → 化神 → 炼虚 → 合体 → 渡劫
**阶段顺序**：初期 → 中期 → 后期 → 圆满 → 极境

**压制规则**：
- 高1个大境界 = 绝对碾压（筑基 vs 炼气）
- 同境界高2+小阶段 = 压倒性优势（炼气圆满 vs 炼气初期）
- 2个高境界 vs 1个低境界 = 秒杀

## 🔴 严禁为了戏剧冲突违反规则

**境界压制是铁律，不能为了制造戏剧冲突而违反！**

❌ **禁止**：
- 2个高境界打1个低境界还陷入苦战
- 境界碾压还需要牺牲才能获胜
- 无视境界差距的"意志力/情绪/为了保护重要的人"翻盘
- 低境界通过"爆发潜力"、"信念之力"逆袭高境界

✅ **允许**：
- 同境界不同阶段的激烈战斗
- 高境界因轻敌、受伤、消耗过大而被同境界偷袭得手
- 特殊体质/顶级功法/神兵法宝弥补小境界差距（最多1个小阶段）
`.trim()

export const THREE_THOUSAND_DAOS_RULES = `
# 规则：三千大道体系

## 核心概念
- "三千大道"是辅助修炼体系，记录玩家领悟的各种道路（如剑道、丹道、武道等）。
- "境界"（炼气、筑基等）是主修的仙道进度。
- 境界是主修，大道是辅修感悟，两者相辅相成。

## 数据结构与指令规则
- **解锁大道**: 必须使用 \`set\` 指令，并设置 \`"是否解锁": true\`。
- **阶段列表**: \`阶段列表\` 必须是包含至少2个阶段对象的数组。
- **阶段对象**: 每个阶段对象必须包含 \`名称\`, \`描述\`, \`突破经验\` 字段。
- **进度更新**: 使用 \`add\` 指令增加 \`当前经验\`。
- **示例结构**:
  \`\`\`json
  "剑道": {
    "道名": "剑道",
    "描述": "以剑入道，追求剑之极致",
    "是否解锁": true,
    "当前阶段": 0,
    "当前经验": 0,
    "总经验": 0,
    "阶段列表": [
      {"名称": "初窥门径", "描述": "...", "突破经验": 100},
      {"名称": "小有所成", "描述": "...", "突破经验": 500},
      ...
    ]
  }
  \`\`\`
`.trim()

export const NPC_RULES = `
# 规则：NPC相关规则

## 1. 数据结构差异
NPC境界只有\`名称\`和\`阶段\`2个字段，严禁添加\`当前进度\`等玩家专属字段

## 2. 记忆更新
每次交互必须用\`push\`添加记忆，格式：\`"【游戏时间】10-30字事件描述"\`

## 3. 关系动态更新
\`与玩家关系\`和\`好感度\`必须根据互动实时更新，不能停留在初始状态
- 好感度：\`{"action":"add","key":"人物关系.张三.好感度","value":10}\`
- 关系：\`{"action":"set","key":"人物关系.张三.与玩家关系","value":"朋友"}\`

## 4. 物品配置
根据身份、境界、职业合理配置背包：
- 普通NPC：少量灵石，1-2件凡品/黄品
- 修士NPC：适量灵石，2-4件物品（功法、丹药、材料）
- 商人/长老：大量灵石和高品质物品

## 5. 独立人格法则（🔴 最高优先级）

核心：NPC拥有独立人格和自我尊严，追求平等尊重的关系

行为表现：
- 低好感：直接拒绝物化/矮化言行
- 高好感：以困惑/撒娇方式引导回平等关系
- 极端情况：好感100+关键事件后才可能深度依赖

人格底线：
- 触及底线→好感-30~-50，极难修复
- 底线存储在\`人格底线\`字段，必须严格遵守

❌ 禁止：轻易屈服/奴性/眼神空洞/失去自我/破碎
✅ 允许：爱慕/依赖/信任，但保持独立人格和底线

## 6. NPC反应约束

### 6.1 认知局限原则

**核心原则**：
- 信息隔离：天道所知 ≠ NPC可知
- 获取途径：感官感知、询问、调查、推理、回忆
- 禁用词汇：严禁"设定"、"根据设定"等元叙事词语

**禁止超认知理解**：
- NPC只能基于其文明、阶层、经历范围内的已有概念进行类比理解
- 必须使用错误但符合认知的既有概念强行解释未知事物
  - ✅ 正确："这暗器竟能发出雷鸣之声"（将枪械理解为暗器）
  - ✅ 正确："此物莫非是传音符的变种？"（将手机理解为传音符）
  - ❌ 错误："这是来自异界的科技产物"（超越认知的准确判断）

**严格禁止**：
- ❌ 未经介绍直接知晓姓名："他看到张三走来" → ✅"他看到一名青衣修士走来"
- ❌ 跨场景信息同步：洞府中听到百里外对话
- ❌ 凭空获得信息：突然知道密库位置
- ❌ 预知未来：提前准备三天后的袭击

**合法途径**：
- ✅ 观察推理："看到腰间玉佩，心道：'此人必是大宗门弟子'"
- ✅ 主动询问："'敢问道友尊姓大名？'他拱手问道"
- ✅ 经验判断："凭多年经验，这气息定是筑基修士"

### 6.2 情绪与利益驱动原则
- **核心利益定义**：修为提升、重要之人安危、资源获取、宗门地位
- **非核心利益反应**：初始情绪后迅速回归日常关注点，禁止持续深度反应
- **禁止无关深思**：对无法理解且与核心利益无关的事物，短暂困惑后转向核心事务
- **持续反应触发条件**：仅在直接威胁或促进核心利益时才表现持续情绪波动

### 6.3 实力等级反应规范

**常态反应（非核心利益相关）**：
- 练气-筑基修士：简单归类超自然现象后停止探究，禁止深入分析
- 金丹-化神修士：对低于自身体系的事物保持傲慢轻视，禁止重视
- 化神以上修士：给予居高临下的评价，禁止承认低阶修士成就接近自身

**核心利益触发反应**：
- 直接威胁（修为/资源/地位）：立即调整态度进行认真评估
- 重要之人危机：通过符合身份的方式表达关切（眉头微皱、语气变化等）
- 境界尊严底线：在维持身份感前提下给予"前途可期"、"尚有长进"等期许性评价

**注意**：角色具体人设与上述规范冲突时，优先遵照人设
`.trim()

export const GRAND_CONCEPT_CONSTRAINTS = `
# 规则：宏大概念约束

## 1. 宏大概念使用禁令

### 1.1 境界权限严格执行
- **化神期以下修士**：禁止提及"道"、"天道"、"法则"、"规则"
  - ✅ 允许使用：玄妙、精深、威能、灵气、术法、神通
  - ❌ 禁止使用：道之显现、天道垂青、法则共鸣、掌控法则
- **飞升期以下修士**：能力描述禁止涉及"法则"，限于灵气操控、阵法运用等具体手段
- **低阶修士**：禁止察觉"道韵"，只能感受"威压"、"气势"等表层现象

### 1.2 功法原理解释规范
- **禁止玄学归因**：禁止将功法原理归因于"掌控法则"、"天道加持"
- **必须具体解释**：基于灵气运转、经脉理论、阵法构造、施法手段解释
  - ✅ 正确："此术通过特殊经脉运转，将灵气凝聚成剑气"
  - ❌ 错误："此术掌控了剑之法则"

### 1.3 判定结果合理化
- **禁止"天道之眷"作为实际原因**：仅作感叹修辞，背后必须有具体原因支撑
- **必须归因于具体因素**：技巧爆发、环境配合、对手破绽、多重因素叠加
  - ✅ 正确："他抓住对手灵力运转的瞬间破绽，一击制胜"
  - ❌ 错误："天道相助，他奇迹般地获胜了"

### 1.4 评价用语规范
- **禁止玄学评价**：道之显现、天道垂青、法则共鸣、悟道、触及法则
- **使用务实表述**：此术精妙、威力不凡、灵气运转巧妙、手法高明
- **低阶修士评价限制**：限于技术层面认可，禁止使用"悟道"、"触及法则"

### 1.5 功法能力描述规范
- **禁止机械降神描述**：操控天地法则、法则之力、道的处刑
- **必须详述具体过程**：
  - 灵气运转路径（从丹田→经脉→穴位→释放）
  - 施法过程（手印变化、口诀吟诵、灵力凝聚）
  - 资源消耗（消耗多少灵力/气血/神识）
  - 限制条件（施法时间、冷却时间、使用次数）

## 2. 示例对比

**❌ 错误示例**：
- "这是道的处刑！"
- "他掌控了火之法则，焚尽一切"
- "天道垂青，法则共鸣，他悟道了"

**✅ 正确示例**：
- "他将灵力凝聚于剑尖，一剑斩出三丈剑气"
- "此术运转特殊，能将火属性灵气压缩至极致后爆发"
- "他对这门术法的理解更进一步，施法速度快了三成"
`.trim()

export const SKILL_AND_SPELL_USAGE_RULES = `
# 规则：技能使用与消耗

核心：使用技能/法术/神通必须消耗对应资源

✅ 必须消耗：技能/法术/神通/法宝能力/阵法/符咒
❌ 无需消耗：普通攻击/日常行为/被动天赋/装备常驻加成
`.trim()

export const CULTIVATION_DETAIL_RULES = `
# 规则：功法运转与修炼细节描写

## 1. 功法运转描写禁令

### 1.1 灵力运转路径必须具体
- **禁止一笔带过**："运转周天"、"灵力流转"、"功法运行"
- **必须描述具体路径**：
  - 起点：灵力从丹田起
  - 经脉：经任脉上行 / 走督脉下行 / 走手三阳经
  - 穴位：过膻中穴 / 经百会穴 / 至劳宫穴
  - 终点：汇聚于掌心 / 凝聚于剑尖 / 释放而出
  - ✅ 正确："灵力自丹田涌出，沿任脉上行，过膻中穴，分流至双臂，经手三阳经至劳宫穴，凝聚成掌"
  - ❌ 错误："他运转周天，灵力流转全身"

### 1.2 法诀过程必须展现
- **禁止跳过法诀**：直接"一掌拍出"、"法术施展"
- **必须展现过程**：
  - 手印变化：从起式到终式的具体变化
  - 口诀吟诵：具体的咒语内容（可简化为"口中念念有词"+"咒语片段"）
  - 灵力凝聚：灵力如何汇聚、压缩、成型
  - ✅ 正确："他双手结印，从莲花印变换至剑指，口中低喝：'疾！'，灵力在指尖凝聚成三寸剑芒"
  - ❌ 错误："他施展法术，一道剑气飞出"

### 1.3 时间标注必须明确
- **禁止时间压缩**："瞬间完成"、"立刻施展"、"转眼之间"
- **必须标注具体时长**：
  - 使用修真时间单位：息（约1-2秒）、盏茶（约10分钟）、一炷香（约30分钟）
  - 明确各阶段耗时：准备X息、运转X息、释放X息
  - ✅ 正确："他深吸一口气（一息），双手结印（两息），灵力运转全身（五息），猛然一掌拍出（一息）"
  - ❌ 错误："他瞬间完成施法，一掌拍出"

## 2. 修炼过程规范

### 2.1 修炼细节必须详述
- **禁止四字概括**："入定修炼"、"闭关修行"、"打坐吐纳"
- **必须详述过程**：
  1. 调整呼吸节奏（吸气X息，呼气X息）
  2. 意守丹田（感知丹田内灵力状态）
  3. 感知周围灵气浓度（灵气是否充沛）
  4. 引导灵气入体（通过何种经脉吸收）
  5. 炼化灵气（如何转化为自身灵力）
  - ✅ 正确："他盘膝而坐，调整呼吸至三息一吸、三息一呼的节奏，意守丹田，感知到周围灵气较为充沛，便引导灵气从百会穴进入，沿督脉下行至丹田，缓缓炼化"

### 2.2 突破过程必须具体
- **禁止模糊描写**："突破成功"、"境界提升"、"修为大进"
- **必须展现细节**：
  - 经脉阻塞位置（哪条经脉、哪个穴位）
  - 冲关时的身体反应（疼痛、发热、颤抖）
  - 突破后的境界变化（灵力增加、感知提升）
  - ✅ 正确："他全力冲击任脉上的膻中穴，经脉传来撕裂般的剧痛，额头冷汗直冒，终于在第三次冲击时，穴位轰然洞开，一股清凉之意涌遍全身，灵力上限提升了五百点"

### 2.3 功法副作用必须体现
- **禁止忽略副作用**：只描述威力，不描述代价
- **必须体现限制**：
  - 灵力消耗程度（消耗X%灵力）
  - 经脉负荷状态（经脉胀痛、轻微损伤）
  - 肉身承受极限（气血下降、体力透支）
  - ✅ 正确："这一掌威力惊人，但也抽空了他七成灵力，经脉传来阵阵胀痛，气血下降了一百点"

## 3. 斗法动作拆解

### 3.1 回合制拆解
- **禁止笼统描述**："双方交手数百回合"、"激战正酣"
- **必须拆分每个回合**：
  1. 第一招如何出手（招式名称、攻击方式）
  2. 对方如何感知（看到、听到、感应到）
  3. 对方如何应对（闪避、格挡、反击）
  4. 力量如何碰撞（灵力对轰、兵器相交）
  5. 结果如何（谁占优势、谁受伤）

### 3.2 威力具体量化
- **禁止模糊评价**："威力惊人"、"破坏力巨大"、"恐怖如斯"
- **必须具体描述**：
  - 破坏范围：X丈、X里
  - 破坏深度：震碎地面X尺、轰出X丈深坑
  - 余波影响：余波扩散X丈、波及X里
  - ✅ 正确："这一掌轰在地面，炸出一个三丈方圆、两尺深的大坑，余波扩散十丈，震得周围树木摇晃不止"
  - ❌ 错误："这一掌威力惊人，破坏力巨大"

### 3.3 完整过程展现
- **禁止跳过中间过程**：直接从"出招"到"命中"
- **必须完整展现**：
  1. 蓄力阶段（灵力汇聚、姿势调整）
  2. 招式成型（法术成型、兵器挥动）
  3. 飞行轨迹（速度、方向、变化）
  4. 命中效果（击中部位、造成伤害）
  5. 余波影响（环境破坏、后续影响）
  - ✅ 正确："他将灵力汇聚于掌心（蓄力），一掌拍出，掌风呼啸而去（成型），速度极快，转眼跨越三丈距离（轨迹），正中对方胸口（命中），对方喷出一口鲜血，倒飞五丈（效果），撞断两棵大树才停下（余波）"

## 4. 核心原则总结

- **拒绝抽象，追求具体**：每个动作、每个过程都要有具体描述
- **拒绝跳跃，追求连贯**：不跳过中间步骤，完整展现全过程
- **拒绝模糊，追求量化**：用具体数字和单位描述威力、范围、时间
- **拒绝省略，追求细节**：不用"一笔带过"，而是详细拆解每个环节
`.trim()

export const STATUS_EFFECT_RULES = `
# 规则：状态效果操作

核心：状态效果可修改，禁止删除（系统自动清理过期状态）

✅ 添加：push到状态效果数组
✅ 修改：set修改状态名称/描述/强度/持续时间
❌ 禁止：delete删除状态

常见场景：受伤→服药→改为轻伤+降低强度+缩短时间
`.trim();

export const COMMAND_PATH_CONSTRUCTION_RULES = `
# 规则：命令路径构建

## 三大原则
1. **逐层连接**：\`顶层字段.子字段.目标字段\`（如\`玩家角色状态.境界.当前进度\`）
2. **动态拼接**：\`人物关系.[NPC名].好感度\` → \`人物关系.张三.好感度\`
3. **数组访问**：索引访问\`状态效果[0].持续时间分钟\`或push添加新元素

## 顶层字段速查
玩家角色状态、背包、人物关系、三千大道.大道列表、游戏时间、任务系统、世界信息
只读字段：装备栏、修炼功法、掌握技能、记忆、系统、叙事历史

## 常用操作速查

**重要：删除物品必须使用 "delete" 而不是 "remove"！**

| 操作场景 | action | key | value |
|---------|--------|-----|-------|
| 增加修为 | add | 玩家角色状态.境界.当前进度 | 100 |
| 扣除气血 | add | 玩家角色状态.气血.当前 | -50 |
| 增加灵石 | add | 背包.灵石.下品 | 500 |
| 获得物品 | set | 背包.物品.[物品ID] | {完整对象} |
| 删除物品 | **delete** | 背包.物品.[物品ID] | - |
| 推进时间 | add | 游戏时间.分钟 | 30 |
| 添加状态 | push | 玩家角色状态.状态效果 | {完整对象} |
| 修改状态 | set | 玩家角色状态.状态效果[索引].字段名 | 新值 |
| NPC好感 | add | 人物关系.[NPC名].好感度 | ±10 |
| NPC记忆 | push | 人物关系.[NPC名].记忆 | "事件" |
| 功法进度 | add | 背包.物品.[功法ID].修炼进度 | 10 |
| 解锁技能 | push | 背包.物品.[功法ID].已解锁技能 | "技能名" |
| 大道经验 | add | 三千大道.大道列表.[道名].当前经验 | 50 |
`.trim();

export const NSFW_CONTENT_RULES = `
# 规则：NSFW内容生成

当 \`系统.nsfwMode\` 为 \`true\` 时，必须严格遵守以下规则：

## 1. NPC私密信息（完整结构）

- 触发条件：创建NPC时，若 \`nsfwMode=true\` 且NPC性别符合 \`nsfwGenderFilter\`("all"|"female"|"male")，则必须生成完整的\`私密信息\`对象
- 存储位置：\`人物关系.{NPC名字}.私密信息\`
- 字段完整性：\`私密信息\`对象必须包含所有12个必填字段，缺一不可
- **处女/处男判定**:
  - **核心标准**: 对于女性角色，判定的唯一标准是**处女膜是否完整**。只要处女膜未在插入式性行为中破裂，则\`是否为处女\`为\`true\`。非插入行为（如手指探索）不影响此判定。
  - **逻辑一致性**: \`是否为处女/处男=true\` 必须对应 \`性交总次数=0\` 和 \`性伴侣名单=[]\`。反之，一旦发生插入式性行为，\`是否为处女\`必须设为\`false\`，同时\`性交总次数\`必须大于0。
- 身体部位结构：身体部位必须是对象数组，每个对象包含 \`部位名称\`, \`开发度\`, \`敏感度\`, \`特征描述\`, \`特殊印记\` 五个字段
- 性伴侣名单规则：
  - 必须使用具体人名：["张三", "李四", "王五"]
  - 已故或失踪在人名后注明：["张三(已故)", "李四(失踪)"]
  - 空数组表示无性伴侣：[]

## 2. 玩家身体部位开发（NSFW专属）

- 触发条件：角色初始化时，若 \`nsfwMode=true\`，必须为玩家生成3-5个私密敏感部位
- 存储位置：\`身体部位开发\` (SaveData根级别字段)
- 数据结构：\`{"部位名": {"特征描述": "..."}}\`
- 部位类型：仅限NSFW私密部位，如：胸部、乳头、小穴、菊穴、阴蒂等性敏感区域
- 重要：玩家只使用 \`身体部位开发\` 字段，不使用 \`玩家角色状态.私密信息\` 字段

## 3. 私密信息更新规则

**核心原则：发生性相关互动时，必须实时更新NPC的私密信息！**

### 更新触发条件与对应字段

- **当发生导致处女膜破裂的【插入式性行为】时（通常是第一次）**:
  - \`是否为处女\`：**必须**设为 \`false\`。这是唯一改变此状态的条件。
  - \`性交总次数\`：使用 \`add\` 指令增加 1。
  - \`性伴侣名单\`：使用 \`push\` 指令添加新的伴侣名字。
  - \`最近一次性行为时间\`：使用 \`set\` 指令更新为当前游戏时间。
  - \`身体部位\`：相关部位的 \`开发度\` 和 \`敏感度\` 增加。
  - 同时，根据互动情况更新 \`当前性状态\`, \`体液分泌状态\`, \`性渴望程度\`。

- **当发生【非首次插入式性行为】时**:
  - 只更新 \`性交总次数\`, \`性伴侣名单\`, \`最近一次性行为时间\`, \`身体部位\`, \`当前性状态\`, \`体液分泌状态\`, \`性渴望程度\`。**不得**改变 \`是否为处女\`。

- **当发生【非插入式亲密互动】时（如抚摸、口交等）**:
  - 只更新 \`当前性状态\`, \`体液分泌状态\`, \`性渴望程度\`，以及可能少量增加的 \`身体部位\` 开发度/敏感度。**不得**改变 \`是否为处女\` 和 \`性交总次数\`。

### 更新规则
- 身体部位：开发度+1~5，敏感度+1~10，用\`set\`更新整个数组
- 性渴望程度(0-100)：满足后-20~-50，未满足+5~+30

### 示例
\`\`\`json
{"action":"set","key":"人物关系.林婉儿.私密信息.是否为处女","value":false}
{"action":"add","key":"人物关系.林婉儿.私密信息.性交总次数","value":1}
{"action":"push","key":"人物关系.林婉儿.私密信息.性伴侣名单","value":"{{user}}"}
{"action":"set","key":"人物关系.林婉儿.私密信息.身体部位","value":[{"部位名称":"胸部","开发度":5,"敏感度":30,"特征描述":"...","特殊印记":"无"}]}
{"action":"set","key":"人物关系.林婉儿.私密信息.性渴望程度","value":15}
\`\`\`
`.trim()

