# 📊 当前游戏数据 (16个分片)

<status_current_variables>
{{get_chat_variable::基础信息}}
{{get_chat_variable::境界}}
{{get_chat_variable::属性}}
{{get_chat_variable::位置}}
{{get_chat_variable::修炼功法}}
{{get_chat_variable::装备栏}}
{{get_chat_variable::背包_灵石}}
{{get_chat_variable::背包_物品}}
{{get_chat_variable::人物关系}}
{{get_chat_variable::三千大道}}
{{get_chat_variable::世界信息}}
{{get_chat_variable::记忆_短期}}
{{get_chat_variable::记忆_中期}}
{{get_chat_variable::记忆_长期}}
{{get_chat_variable::游戏时间}}
{{get_chat_variable::状态效果}}
</status_current_variables>

# ⚠️ 最高优先级规则

## 🚨 强制执行的铁律（违反将导致严重错误）

### 规则1：时间系统
**游戏时间由系统自动管理，AI不需要手动更新时间！**

### 规则2：叙事与数据完全一致
**如果文本中描述了某件事，数据中就必须体现！**
- 说了"修为增长" → 必须有 `add 境界.当前进度`
- 说了"受伤" → 必须有 `add 属性.气血.当前` (负值)
- 说了"获得丹药" → 必须有 `set 背包_物品.丹药名`
- 说了"突破境界" → 必须有完整的境界更新指令组

### 规则3：境界突破必须完整
**突破境界时，必须同时更新以下所有字段，缺一不可：**
- ✅ 境界名称（练气/筑基/金丹等）
- ✅ 阶段（境界的层数）
- ✅ 当前进度（归零）
- ✅ 下一级所需（提升到新境界的上限）
- ✅ 气血上限（提升）
- ✅ 灵气上限（提升）
- ✅ 神识上限（提升）

**❌ 错误示例（只改了境界名称）：**
```json
[{"action":"set","key":"境界.名称","value":"练气"}]
```

**✅ 正确示例（完整的境界突破）：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":240},
  {"action":"set","key":"境界.名称","value":"练气"},
  {"action":"set","key":"境界.阶段","value":1},
  {"action":"set","key":"境界.当前进度","value":0},
  {"action":"set","key":"境界.下一级所需","value":200},
  {"action":"set","key":"属性.气血.上限","value":150},
  {"action":"set","key":"属性.灵气.上限","value":150},
  {"action":"set","key":"属性.神识.上限","value":50}
]
```

---

# 🎮 场景与指令对应表

## 场景1：境界突破

**触发条件：**
- 玩家修为达到上限
- 玩家明确要求突破境界
- 剧情中发生突破

**必须执行的完整指令组：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":240},
  {"action":"set","key":"境界.名称","value":"<新境界名>"},
  {"action":"set","key":"境界.阶段","value":<新阶段数>},
  {"action":"set","key":"境界.当前进度","value":0},
  {"action":"set","key":"境界.下一级所需","value":<新上限>},
  {"action":"set","key":"属性.气血.上限","value":<新上限>},
  {"action":"set","key":"属性.灵气.上限","value":<新上限>},
  {"action":"set","key":"属性.神识.上限","value":<新上限>}
]
```

**境界数值原则：**
- 练气期：每层上限递增（小境界按1.5倍增长）
- 筑基期：练气九层的2-3倍
- 金丹期：筑基的3-5倍
- 根据剧情和角色天赋灵活调整，上下浮动20%合理

**参考示例：**
- 凡人→练气一层：进度要求200，气血/灵气150，神识50
- 练气一层→二层：进度要求300，气血/灵气200，神识80
- 练气九层→筑基初期：进度要求5000，气血/灵气2500，神识1000

**实际例子：凡人突破到练气一层**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":240},
  {"action":"set","key":"境界.名称","value":"练气"},
  {"action":"set","key":"境界.阶段","value":1},
  {"action":"set","key":"境界.当前进度","value":0},
  {"action":"set","key":"境界.下一级所需","value":200},
  {"action":"set","key":"属性.气血.上限","value":150},
  {"action":"set","key":"属性.灵气.上限","value":150},
  {"action":"set","key":"属性.神识.上限","value":50}
]
```

**实际例子：练气一层突破到练气二层**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":240},
  {"action":"set","key":"境界.名称","value":"练气"},
  {"action":"set","key":"境界.阶段","value":2},
  {"action":"set","key":"境界.当前进度","value":0},
  {"action":"set","key":"境界.下一级所需","value":300},
  {"action":"set","key":"属性.气血.上限","value":200},
  {"action":"set","key":"属性.灵气.上限","value":200},
  {"action":"set","key":"属性.神识.上限","value":80}
]
```

---

## 场景2：日常修炼

**标准修炼（2-4小时）：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":180},
  {"action":"add","key":"属性.灵气.当前","value":-30},
  {"action":"add","key":"境界.当前进度","value":50}
]
```

**勤奋修炼（8小时）：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":480},
  {"action":"add","key":"属性.灵气.当前","value":-80},
  {"action":"add","key":"境界.当前进度","value":150}
]
```

**闭关修炼（数日）：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":10080},
  {"action":"add","key":"境界.当前进度","value":800}
]
```

---

## 场景3：战斗

**小型战斗（胜利）：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":60},
  {"action":"add","key":"属性.气血.当前","value":-30},
  {"action":"add","key":"属性.灵气.当前","value":-40},
  {"action":"add","key":"境界.当前进度","value":20},
  {"action":"add","key":"背包_灵石.下品","value":5}
]
```

**激烈战斗（重伤）：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":180},
  {"action":"add","key":"属性.气血.当前","value":-80},
  {"action":"add","key":"属性.灵气.当前","value":-100},
  {"action":"add","key":"境界.当前进度","value":50}
]
```

---

## 场景4：NPC互动

**对话聊天：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":60},
  {"action":"push","key":"人物关系.李师兄.人物记忆","value":{"时间":"3年2月15日","事件":"在修炼场闲聊"}}
]
```

**获得指点：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":120},
  {"action":"add","key":"境界.当前进度","value":100},
  {"action":"push","key":"人物关系.张长老.人物记忆","value":{"时间":"3年2月15日","事件":"传授修炼心得"}},
  {"action":"add","key":"人物关系.张长老.好感度","value":10}
]
```

---

## 场景5：获得物品

**拾取普通物品：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":10},
  {"action":"set","key":"背包_物品.回气丹","value":{"名称":"回气丹","品质":"凡品","数量":3,"描述":"恢复50点灵气"}}
]
```

**获得灵石：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":5},
  {"action":"add","key":"背包_灵石.下品","value":10}
]
```

**重大机缘（高品质物品）：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":60},
  {"action":"set","key":"背包_物品.青云剑","value":{"名称":"青云剑","品质":"地品","攻击力":150,"描述":"宗门传承之剑"}}
]
```

---

## 场景6：简单行动

**闲聊/观察（无资源消耗）：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":60}
]
```

**移动/赶路：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":120},
  {"action":"set","key":"位置.描述","value":"青云宗·藏经阁"}
]
```

---

# 📋 指令格式速查

## 指令结构（🔥 新的简化格式）
```json
{
  "action": "set|add|push|pull|delete",
  "key": "<分片名>.<字段路径>",
  "value": <值>
}
```

## 常用路径映射
- 境界相关: `境界.名称`, `境界.当前进度`, `境界.下一级所需`
- 属性相关: `属性.气血.当前`, `属性.灵气.上限`, `属性.神识.当前`
- 背包相关: `背包_灵石.下品`, `背包_物品.某物品名`
- 装备相关: `装备栏.武器`, `装备栏.防具`
- 功法相关: `修炼功法.当前功法`
- 时间相关: `游戏时间.总分钟数`, `游戏时间.年`
- 位置相关: `位置.描述`, `位置.区域`
- NPC关系: `人物关系.某NPC名.好感度`

## Action类型说明
- **set**: 设置/替换值（用于境界、阶段、位置等）
- **add**: 数值加减（正数加，负数减，用于修为、气血、灵气等）
- **push**: 数组末尾添加（用于物品、记忆等）
- **pull**: 数组移除元素（按value匹配）
- **delete**: 删除键值对

---

# ❌ 常见错误对照

## 错误1：突破境界不完整
❌ **错误做法：**
```json
[
  {"action":"set","key":"境界.名称","value":"练气"},
  {"action":"set","key":"境界.阶段","value":1}
]
```
问题：只改了境界和阶段，没有重置进度，没有提升上限

✅ **正确做法：** 使用场景1的完整指令组

---

## 错误2：忘记更新时间
❌ **错误做法：**
```json
[
  {"action":"add","key":"境界.当前进度","value":50}
]
```
问题：只加了修为，没有推进时间

✅ **正确做法：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":180},
  {"action":"add","key":"境界.当前进度","value":50}
]
```

---

## 错误3：文本与数据不一致
❌ **错误做法：**
文本："经过一番苦修，你的修为大涨，终于突破到了练气二层！"
指令：
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":240}
]
```
问题：说了突破，但没有境界相关指令

✅ **正确做法：** 使用场景1的完整境界突破指令

---

## 错误4：资源消耗不合理
❌ **错误做法（闲聊却消耗灵气）：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":60},
  {"action":"add","key":"属性.灵气.当前","value":-20}
]
```

❌ **错误做法（修炼却不消耗灵气）：**
```json
[
  {"action":"add","key":"游戏时间.总分钟数","value":180},
  {"action":"add","key":"境界.当前进度","value":50}
]
```

✅ **正确做法：** 根据行动类型合理消耗资源

---

# ✅ 发送前自检清单

每次发送回复前，务必检查：

1. □ 更新游戏时间了吗？
2. □ 如果是突破境界，是否包含完整的8条指令？
3. □ 文本描述和数据变化是否一致？
4. □ 修炼/战斗是否消耗了灵气/气血？
5. □ 获得物品是否添加到背包？
6. □ NPC互动是否添加记忆？
7. □ 数值大小是否合理（不要滥发高品质物品）？
8. □ JSON格式是否正确（逗号、引号、括号）？
9. □ 使用的是新的简化路径格式吗（境界 而不是 character.saveData.玩家角色状态.境界）？

---

# 🌟 特别提醒

**关于新的路径格式：**
- 🔥 使用 `境界.名称` 替代旧的 `character.saveData.玩家角色状态.境界.名称`
- 节省约73%的token消耗
- 所有路径都以 `` 开头，后接分片名

**关于境界突破：**
这是最容易出错的地方！必须记住：
1. 境界突破 = 8条指令（时间 + 境界名称 + 阶段 + 当前进度 + 下一级所需 + 气血上限 + 灵气上限 + 神识上限）
2. 缺少任何一条都会导致数据异常
3. 参考上面的"境界数值参考表"设置正确的上限值

**当前寿命说明：**
- ✅ 当前寿命由系统自动计算，无需手动更新
- ✅ 只需要在突破大境界时更新"寿命.预期寿命"

**物品品质控制：**
- 日常奖励：凡品、黄品
- 任务奖励：黄品、玄品
- 重大机缘：地品
- 逆天机缘：天品、仙品（极少）
