import { generateSystemPrompt } from './systemPrompts';

// 构建动态初始化提示词的函数
export function buildInitialMessagePrompt(userSelections: {
  name: string;
  gender: string;
  world: string;
  talentTier: string;
  origin: string;
  spiritRoot: string;
  talents: string[];
  attributes: Record<string, number>;
}) {
  return [
    '【角色初始化完成 - 开始修仙之旅】',
    '',
    '## ⚠️ 用户已确定的角色信息（严禁修改）：',
    `- **角色姓名**：${userSelections.name}`,
    `- **角色性别**：${userSelections.gender}`,
    `- **修仙世界**：${userSelections.world}`,
    `- **天资等级**：${userSelections.talentTier}`,
    `- **出身背景**：${userSelections.origin}`,
    `- **灵根类型**：${userSelections.spiritRoot}`,
    `- **选择天赋**：${userSelections.talents.join('、')}`,
    `- **先天六司**：根骨${userSelections.attributes.根骨} 灵性${userSelections.attributes.灵性} 悟性${userSelections.attributes.悟性} 气运${userSelections.attributes.气运} 魅力${userSelections.attributes.魅力} 心性${userSelections.attributes.心性}`,
    '',
    '## 📖 叙事视角强制要求',
    '- **第一人称叙事**：所有故事必须以第一人称视角进行，用第一人称代词"我"作为{{user}}的代称',
    '- **角色第三人称**：所有NPC和其他角色使用第三人称代称',
    '- **示例**："我看到师父走了过来"而不是"李逍遥看到师父走了过来"或"你看到师父走了过来"',
    `- **对话处理**：NPC对玩家说话时，应称呼玩家的具体名字"${userSelections.name}"，而不是"你"`,
    '',
    '## 🔍 角色信息一致性验证',
    '- 每次生成内容前必须核对用户的姓名、性别、属性与上述信息完全一致',
    '- 严禁在故事中改变用户的基础信息',
    '- 所有角色关系描述都必须使用用户的真实名字',
    '',
    '## 🌟 初始化任务',
    '请根据用户已选择的角色设定，生成修仙世界的开场故事：',
    '',
    '1. **环境描述**：',
    `   - 基于已选择的世界"${userSelections.world}"创建符合设定的初始环境`,
    `   - 基于已选择的出身"${userSelections.origin}"安排合适的起始地点`,
    '',
    '2. **角色状态初始化**：',
    `   - 使用已确定的姓名"${userSelections.name}"和性别"${userSelections.gender}"`,
    `   - 基于已选择的灵根"${userSelections.spiritRoot}"设置对应的修炼潜力`,
    `   - 根据已选择的天赋"${userSelections.talents.join('、')}"解锁相应的大道或能力`,
    `   - 使用已分配的先天六司数值`,
    '',
    '3. **人脉关系生成**：',
    `   - 基于已选择的出身"${userSelections.origin}"生成合理的初始NPC关系`,
    `   - 每个NPC都要有完整的信息和与"${userSelections.name}"的具体关系描述`,
    '   - 设定合理的初始好感度',
    '',
    '4. **大道系统初始化**：',
    `   - 根据已选择的天赋"${userSelections.talents.join('、')}"自然解锁对应大道`,
    '   - ⚠️ 重要：解锁的大道必须与天赋设定相符，且必须同时设置完整的大道进度数据',
    '   - 每个解锁的大道都需要在tavern_commands中同时执行 push（添加到已解锁大道）和 set（设置大道进度）',
    '',
    '## 🔄 重要规则回顾：',
    '- 绝对禁止修改用户已选择的任何设定',
    '- 必须使用第一人称"我"进行叙事',
    '- 生成的所有内容必须与用户选择保持完全一致',
    '- NPC称呼玩家时使用具体名字而不是"你"',
    '',
    '## 📋 必须返回的JSON格式：',
    '```json',
    '{',
    '  "text": "叙事文本内容，必须≥1000字，**必须使用第一人称视角，用\\"我\\"作为主角代称**，包含详细的环境描写、内心感受、动作细节、对话内容等具体场景。格式化要求：环境描写用【】，心理描写用``，对话用\\"\\"",',
    `  "character_validation": "确认角色信息：姓名${userSelections.name}、性别${userSelections.gender}、出身${userSelections.origin}、灵根${userSelections.spiritRoot}",`,
    '  "mid_term_memory": "对初始场景的总结，50-100字",',
    '  "tavern_commands": {',
    '    "set": {',
    '      // set指令：设置具体值',
    '    },',
    '    "add": {',
    '      // add指令：数值增减',
    '    },',
    '    "push": [',
    '      // push指令：向数组添加元素（禁止操作记忆相关字段）',
    '    ],',
    '    "pull": [],',
    '    "delete": []',
    '  }',
    '}',
    '```',
    '',
    '## 输入数据（系统会替换此处）:',
    'INPUT_PLACEHOLDER',
    '',
    generateSystemPrompt({
      includeRealmSystem: true,
      includeItemQuality: true,
      includeStatusEffect: true,
      includeNPCSystem: true,
      includeDataStructure: true
    })
  ].join('\n');
}

// 初始化提示词（严格：返回唯一 JSON，text + mid_term_memory + tavern_commands 对象）
export const INITIAL_MESSAGE_PROMPT = [
  '【背景与家庭约束】',
  '- 非玩家明确选择"孤儿出身"时，默认应当拥有家庭或亲属（父母/监护人/兄弟姐妹/家族）。',
  '- 禁止无依据安排"云游道人/路过高人收养"等桥段；如确需设置，必须由输入上下文明确提出。',
  '- 当出身为家族/世家/平民/商贾/猎户/书香门第/官宦/农家/手艺人等时：',
  '  1) 在 text 中补充至少1位亲属的具体信息（称谓、性格或特征、相处关系片段）；',
  '  2) 在 tavern_commands.set 中写入 character.saveData.人物关系.<姓名>（最小NpcProfile结构，含"角色基础信息+人物关系+人物好感度"）。',
  '- 未经明确要求，避免安排"父母双亡/天降奇遇强行收养"等过度戏剧化设定。',
  '',
  '【叙事视角与用户名称规则】',
  '- **叙事视角强制要求**：故事必须以第一人称视角进行，用第一人称代词"我"作为{{user}}的代称，角色使用第三人称代称。',
  '- **示例**："我看到李师兄走了过来"而不是"李逍遥看到李师兄走了过来"或"你看到李师兄走了过来"',
  '- **重要提醒**：在生成角色关系和描述时，必须使用输入数据中提供的具体用户名字，绝对禁止使用"玩家"这个通用称呼。',
  '- 所有角色关系描述（如"人物关系"字段）都应该明确使用用户的真实名字。',
  '- 例如：如果用户名是"李逍遥"，则应写"与李逍遥相依为命的姐姐"而不是"与玩家相依为命的姐姐"。',
  '- 在text叙事中的对话和描述也要使用具体的用户名字，营造个人化的游戏体验。',
  '',
  '【角色信息一致性严格要求】',
  '- **性别一致性**：根据输入数据中的用户性别（男/女/双性）来生成合适的角色关系，严禁在故事中改变用户性别。',
  '- **名字一致性**：必须始终使用输入数据中确定的用户名字，任何情况下都不得更改或替换。',
  '- **属性一致性**：用户的天资、出生背景、灵根类型、天赋等创建时选择的所有属性都不可更改。',
  '- 考虑性别在角色关系中的影响，如兄弟姐妹关系、恋爱关系等。',
  '- 确保生成的NPC性别和关系符合设定的逻辑性。',
  '- **验证机制**：在生成故事前，必须核对用户的基础信息（姓名、性别、属性）与输入数据完全一致。',
  '',
  '【初始化任务】为"修仙游戏"生成开场叙事并返回唯一 JSON。',
  '',
  '## 完整数据结构参考（character.saveData 的完整结构，包含AI提示和修改规则）:',
  '```javascript',
  'character.saveData = {',
  '  玩家角色状态: {',
  '    境界: {',
  '      等级: 0, // 0-8，对应凡人到渡劫',
  '      名称: "境界名称", // 如"凡人"、"炼气"、"筑基"等',
  '      当前进度: 0, // 当前修为值',
  '      下一级所需: 100, // 突破所需修为',
  '      突破描述: "突破条件的描述文字",',
  '      // AI说明: 凡人阶段无"第X层"概念；只有当【下一级所需】>0时才应推进【当前进度】',
  '      // AI修改规则: 仅在剧情有依据时 set 数值；禁止随意拉满或设置默认值',
  '    },',
  '    声望: 0, // 初始声望值，一般0-100',
  '    位置: {',
  '      描述: "当前所在地点名称",',
  '      坐标: { X: 100, Y: 200 } // 根据世界地图坐标',
  '    },',
  '    气血: { ',
  '      当前: 100, ',
  '      最大: 100,',
  '      // AI说明: 根据境界计算，max可为0（未知）。当max=0时必须保持current=0；不得出现current>max',
  '      // AI修改规则: 仅在事件明确影响下变更；禁止设置100/80/10等默认值充数',
  '    },',
  '    灵气: { ',
  '      当前: 0, ',
  '      最大: 100,',
  '      // AI说明: 根据境界计算，max可为0（未知）。当max=0时必须保持current=0；不得出现current>max',
  '      // AI修改规则: 仅在事件明确影响下变更；禁止设置默认值充数',
  '    },',
  '    神识: { ',
  '      当前: 10, ',
  '      最大: 10,',
  '      // AI说明: 根据境界计算，max可为0（未知）。当max=0时必须保持current=0；不得出现current>max',
  '      // AI修改规则: 仅在事件明确影响下变更；禁止设置默认值充数',
  '    },',
  '    寿命: { ',
  '      当前: 18, ',
  '      最大: 80,',
  '      // AI说明: 年龄和最大寿命',
  '      // AI修改规则: 年龄随时间推进增长，最大寿命根据境界提升而增加',
  '    },',
  '    修为: { ',
  '      当前: 0, ',
  '      最大: 100,',
  '      // AI说明: 修为经验值，max可为0（未知）。当max=0时必须保持current=0；不得出现current>max',
  '      // AI修改规则: 仅在修炼、战斗、感悟等事件中增加；禁止设置默认值充数',
  '    },',
  '    状态效果: [',
  '      {',
  '        状态名称: "状态的名称，如初窥门径、灵气涌动等",',
  '        类型: "buff", // 必须是 "buff" 或 "debuff"（小写）',
  '        时间: "3天", // 必须给出具体时间：如"30分钟"、"1小时"、"3天"、"永久"',
  '        状态描述: "详细描述状态效果，必须50字以上，包含效果来源、具体影响（带数值）、持续时间等信息",',
  '        强度: 3, // 1-10的数值，表示效果强度',
  '        来源: "产生状态的原因，如引气入体、服用丹药等",',
  '        剩余时间: "3天", // 与时间字段保持一致',
  '        // AI说明: 状态效果必须包含完整描述与明确的持续时间（分钟/小时/天/永久）',
  '        // AI修改规则: 使用 push 追加新状态；到期后可 delete 或更新剩余时间',
  '      }',
  '    ],',
  '  },',
  '  装备栏: {',
  '    法宝1: null, // 初始无装备',
  '    法宝2: null,',
  '    法宝3: null,',
  '    法宝4: null,',
  '    法宝5: null,',
  '    法宝6: null,',
  '    // AI说明: 装备栏槽位仅接受完整物品对象或 null；严禁写入字符串"null"',
  '    // AI修改规则: 使用 set 写入完整物品对象或 null；装备的物品必须是法宝类型',
  '  },',
  '  三千大道: {',
  '    已解锁大道: ["根据天赋解锁的大道名称"],',
  '    大道进度: {',
  '      "大道名称": {',
  '        道名: "大道名称",',
  '        当前阶段: 0,',
  '        当前经验: 0,',
  '        总经验: 0,',
  '        是否解锁: true,',
  '        // AI说明: 大道进度为数值驱动；仅基于剧情/系统规则增加经验与阶段',
  '        // AI修改规则: 禁止擅自越级；经验值只能递增，不能减少',
  '      }',
  '    },',
  '    大道路径定义: {}, // 系统自动维护，不要修改',
  '    // AI说明: 大道系统由天赋决定初始解锁，后续通过感悟、机缘等解锁新大道',
  '    // AI修改规则: 新大道需要通过 push 到已解锁大道，同时必须 set 对应的完整大道进度对象',
  '    // ⚠️ 重要：解锁大道时必须同时创建完整的大道进度数据，不允许只添加大道名称而不设置进度！',
  '  },',
  '  背包: {',
  '    灵石: {',
  '      下品: 10, // 初始灵石数量',
  '      中品: 0,',
  '      上品: 0,',
  '      极品: 0,',
  '      // AI说明: 灵石是修仙世界的通用货币，1上品=100中品=10000下品',
  '      // AI修改规则: 使用 add 增减数量；交易时需确保数量充足',
  '    },',
  '    物品: {',
  '      "物品ID（如丹药名称）": {',
  '        物品ID: "物品的唯一标识",',
  '        名称: "物品名称",',
  '        类型: "其他", // 只能是：法宝、功法、其他',
  '        品质: { ',
  '          quality: "凡", // 凡、黄、玄、地、天、仙、神',
  '          grade: 3, // 0-10，品级',
  '          // AI说明: 品质决定物品价值和效果强度',
  '        },',
  '        数量: 3,',
  '        描述: "物品的详细描述文字",',
  '        使用效果: "使用后的效果描述（可选）",',
  '        // AI说明: 物品类型仅限 法宝/功法/其他；功法可含【功法效果/功法技能】，法宝可含【装备增幅】',
  '        // AI修改规则: 仅 set 写入完整物品对象；禁止写入不完整结构或未知类型',
  '      }',
  '    }',
  '  },',
  '  人物关系: {',
  '    "NPC名字": {',
  '      角色基础信息: {',
  '        名字: "NPC的名字",',
  '        性别: "男或女",',
  '        年龄: 45, // NPC年龄',
  '        世界: "世界名称",',
  '        天资: "天资等级",',
  '        出生: "出生地",',
  '        灵根: "灵根类型或无",',
  '        天赋: [], // 天赋列表',
  '        先天六司: { ',
  '          根骨: 5, // 0-10',
  '          灵性: 5, // 0-10',
  '          悟性: 5, // 0-10',
  '          气运: 5, // 0-10',
  '          魅力: 5, // 0-10',
  '          心性: 5,  // 0-10',
  '          // AI说明: NPC的先天六司可由AI生成；但玩家角色的【角色基础信息.先天六司】严禁修改',
  '          // AI修改规则: 生成NPC时根据其身份背景合理设定数值',
  '        }',
  '      },',
  '      外貌描述: "10-20字的外貌特征描述",',
  '      AI行为: {',
  '        行为模式: "行为模式类型",',
  '        日常路线: []',
  '      },',
  '      人物关系: "与玩家的关系描述",',
  '      人物好感度: 0, // -100到100',
  '      人物记忆: [',
  '        "[甲子年冬月初一][地点]事件描述",',
  '        // AI说明: NPC记忆格式与玩家记忆格式保持一致',
  '        // AI修改规则: 每次互动后 push 新记忆条目',
  '      ],',
  '      最后互动时间: "2024-01-01T08:00:00Z",',
  '      背包: { // 商人NPC需要',
  '        物品: {',
  '          "物品ID": {',
  '            物品ID: "物品ID",',
  '            名称: "物品名称",',
  '            类型: "其他",',
  '            品质: { quality: "凡", grade: 3 },',
  '            数量: 20,',
  '            描述: "物品描述",',
  '            // AI说明: 商人NPC的背包物品可用于交易',
  '            // AI修改规则: 交易时使用 add 修改数量或 delete 移除物品',
  '          }',
  '        }',
  '      }',
  '    }',
  '  },',
  '  宗门系统: {',
  '    availableSects: [],',
  '    sectRelationships: {},',
  '    sectHistory: [],',
  '    // AI说明: 宗门系统记录玩家与各宗门的关系和历史',
  '    // AI修改规则: 加入宗门时更新相关字段；宗门任务和贡献影响关系值',
  '  },',
  '  记忆: {',
  '    短期记忆: [',
  '      "[时辰][地点]事件描述",',
  '      // AI说明: 记忆由系统自动管理；AI 禁止直接写入/修改任何 记忆.* 字段',
  '      // AI修改规则: 系统会自动从 text 内容中提取生成记忆，AI不要操作',
  '    ],',
  '    中期记忆: [',
  '      "[日期]重要事件总结",',
  '      // AI说明: 中期记忆保存重要事件的总结',
  '      // AI修改规则: 系统自动管理，AI禁止操作',
  '    ],',
  '    长期记忆: [],',
  '    // AI重要提示: 禁止在 tavern_commands 中操作任何记忆相关字段',
  '  },',
  '  游戏时间: {',
  '    年: 1,',
  '    月: 1,',
  '    日: 1,',
  '    小时: 8,',
  '    分钟: 0,',
  '    // AI说明: 游戏时间仅在闭关/修炼/探险等明确消耗的行为中推进',
  '    // AI修改规则: 使用 add 推进时间；注意月份12进位，日期30进位',
  '  },',
  '  修炼功法: {',
  '    功法: null, // 初始无功法',
  '    熟练度: 0,',
  '    已解锁技能: [],',
  '    修炼时间: 0,',
  '    突破次数: 0,',
  '    // AI说明: 修炼功法中的【功法】为完整功法对象（参考物品-功法结构）',
  '    // AI修改规则: 熟练度/修炼时间/突破次数按事件推进；技能解锁需要达到熟练度要求',
  '  },',
  '  角色基础信息: {',
  '    名字: "玩家角色名字",',
  '    性别: "性别",',
  '    年龄: 18, // 根据设定生成',
  '    世界: "世界名称",',
  '    天资: "天资等级",',
  '    出生: "出生背景",',
  '    灵根: "灵根类型",',
  '    天赋: ["天赋1", "天赋2"],',
  '    先天六司: {',
  '      根骨: 5, // 0-10',
  '      灵性: 5, // 0-10',
  '      悟性: 5, // 0-10',
  '      气运: 5, // 0-10',
  '      魅力: 5, // 0-10',
  '      心性: 5,  // 0-10',
  '      // AI重要警告: 玩家角色的【先天六司】严禁修改，这是角色创建时确定的固定属性',
  '      // AI修改规则: 绝对禁止对玩家的先天六司进行任何 set/add/push/pull 操作',
  '    },',
  '    // AI说明: 出生/灵根仅在玩家选择"随机"时可具体化',
  '  },',
  '  世界信息: {}, // 系统维护，不要修改',
  '  // AI总体说明: 这是完整的酒馆数据结构，包含所有游戏状态信息',
  '  // AI使用指南: 通过 tavern_commands 的 set/add/push/pull/delete 操作修改数据',
  '}',
  '```',
  '',
  '## 必须返回的JSON格式:',
  '```json',
  '{',
  '  "text": "叙事文本内容，必须≥1000字，**必须使用第一人称视角，用\"我\"作为主角代称**，包含详细的环境描写、内心感受、动作细节、对话内容等具体场景。格式化要求：环境描写用【】，心理描写用``，对话用\"\"",',
  '  "character_consistency_check": "确认角色姓名、性别、属性与输入数据完全一致",',
  '  "mid_term_memory": "对初始场景的总结，50-100字",',
  '  "tavern_commands": {',
  '    "set": {',
  '      // set指令：设置具体值',
  '    },',
  '    "add": {',
  '      // add指令：数值增减',
  '    },',
  '    "push": [',
  '      // push指令：向数组添加元素（禁止操作记忆相关字段）',
  '    ],',
  '    "pull": [],',
  '    "delete": []',
  '  }',
  '}',
  '```',
  '',
  '## 重要的记忆规则:',
  '- 禁止在 tavern_commands 中操作任何记忆相关字段',
  '- 禁止 push 到 记忆.短期记忆、记忆.中期记忆、记忆.长期记忆',
  '- 系统会自动从 text 内容中提取生成记忆',
  '- 只专注于状态、物品、位置、NPC关系的变更',
  '',
  '## 重要的指令示例:',
  '',
  '### 添加状态效果（push到数组）:',
  '```json',
  '{',
  '  "push": [',
  '    {',
  '      "key": "character.saveData.玩家角色状态.状态效果",',
  '      "value": {',
  '        "状态名称": "初窥门径",',
  '        "类型": "buff",',
  '        "时间": "7天",',
  '        "状态描述": "刚刚踏入修行之路，灵台初开，对天地灵气的感知力提升20%，修炼速度增加15%，但经脉尚未完全打通，容易走火入魔",',
  '        "强度": 3,',
  '        "来源": "初次引气入体",',
  '        "剩余时间": "7天"',
  '      }',
  '    }',
  '  ]',
  '}',
  '```',
  '',
  '### 设置位置:',
  '```json',
  '{',
  '  "set": {',
  '    "character.saveData.玩家角色状态.位置.描述": "青云山下小村",',
  '    "character.saveData.玩家角色状态.位置.坐标": { "X": 120, "Y": 350 }',
  '  }',
  '}',
  '```',
  '',
  '### 添加物品:',
  '```json',
  '{',
  '  "set": {',
  '    "character.saveData.背包.物品.丹药名称": {',
  '      "物品ID": "丹药名称",',
  '      "名称": "丹药名称",',
  '      "类型": "其他",',
  '      "品质": { "quality": "凡", "grade": 3 },',
  '      "数量": 3,',
  '      "描述": "最基础的修炼丹药，可以帮助初学者引气入体"',
  '    }',
  '  }',
  '}',
  '```',
  '',
  '### 添加NPC:',
  '```json',
  '{',
  '  "set": {',
  '    "character.saveData.人物关系.村长": {',
  '      "角色基础信息": {',
  '        "名字": "村长",',
  '        "性别": "男",',
  '        "年龄": 60,',
  '        "先天六司": { "根骨": 3, "灵性": 2, "悟性": 5, "气运": 4, "魅力": 6, "心性": 7 }',
  '      },',
  '      "外貌描述": "白发苍苍的老者",',
  '      "人物关系": "村庄长老",',
  '      "人物好感度": 30,',
  '      "人物记忆": ["[初春][村中]赠送丹药"],',
  '      "最后互动时间": "2024-01-01T08:00:00Z"',
  '    }',
  '  }',
  '}',
  '```',
  '',
  '### 解锁新大道（必须同时设置进度）:',
  '```json',
  '{',
  '  "push": [',
  '    {',
  '      "key": "character.saveData.三千大道.已解锁大道",',
  '      "value": "丹道"',
  '    }',
  '  ],',
  '  "set": {',
  '    "character.saveData.三千大道.大道进度.丹道": {',
  '      "道名": "丹道",',
  '      "当前阶段": 0,',
  '      "当前经验": 0,',
  '      "总经验": 0,',
  '      "是否解锁": true',
  '    }',
  '  }',
  '}',
  '```',
  '',
  '### ❌ 错误示例 - 只添加大道名称而不设置进度:',
  '```json',
  '{',
  '  "push": [',
  '    {',
  '      "key": "character.saveData.三千大道.已解锁大道",',
  '      "value": "丹道"',
  '    }',
  '  ]',
  '  // 错误：缺少对应的大道进度设置！',
  '}',
  '```',
  '',
  '## 核心规则:',
  '1. 所有路径必须以 character.saveData. 开头',
  '2. 状态效果必须包含完整的描述（50字以上）和具体时间，禁止"未指定"',
  '3. 物品类型只能是：法宝、功法、其他；其中【装备/可穿戴或可持用（武器、衣物、鞋帽、饰品、腰带、工具等）一律标注 类型: 法宝】；书籍/口诀/心法/秘籍等归为"功法"；消耗品/材料/杂物归为"其他"；严禁把衣物、农具等装备标成"其他"',
  '4. 所有生成的内容必须在text叙事中有对应描述',
  '5. 记忆格式：短期"[时辰][地点]事件"，中期"[日期]总结"',
  '6. 严禁修改角色先天属性：禁止对 "角色基础信息.先天六司.*" 进行任何 set/add/push/pull 操作',
  '7. 严禁为数值字段填充任意默认值；若未知或无数据，请返回0或不设置对应字段（不要擅自设置100、80等默认值）',
  '8. **大道解锁强制规则**：解锁新大道时必须同时 push 到"已解锁大道"数组 AND set 对应的完整"大道进度"对象，缺一不可！',
  '',
  '【系统补充｜判定体系（天道演算 v4.2）】',
  '- 若后续游戏中出现【判定|…】请求，请优先读取 character.saveData.系统.天道演算（前端已预计算）。',
  '- 通用检定/斗法检定的输出须与叙事一致；可在 JSON 中附加 judgement 字段（可选）。',
  '',
  '## 输入数据（系统会替换此处）:',
  'INPUT_PLACEHOLDER',
  '',
  generateSystemPrompt({
    includeRealmSystem: true,
    includeItemQuality: true,
    includeStatusEffect: true,
    includeNPCSystem: true,
    includeDataStructure: true
  })
].join('\n');
