import { ROLE_PLAY_INSTRUCTION } from './gameElementPrompts';
/**
 * 数据结构定义（仅结构，不含操作说明）
 */

export const DATA_STRUCTURE_DEFINITIONS = `
# 数据结构定义

⚠️ **JSON格式严格要求（最重要）**：
- **禁止使用任何注释**：JSON 不支持 // 或 /* */ 注释，添加注释会导致解析失败！
- **禁止使用尾随逗号**：数组或对象最后一个元素后不能有逗号
- **字符串必须用双引号**：所有字符串必须使用 "双引号"，不能使用 '单引号'
- **严格遵守JSON语法**：确保所有括号、引号、逗号正确配对

⚠️ **地图坐标系统**：
- **经度范围**：100.0° - 130.0°（东经，30度跨度）
- **纬度范围**：25.0° - 45.0°（北纬，20度跨度）
- **坐标精度**：保留2-4位小数（例如：115.2345, 35.6789）
- **位置更新**：移动位置时必须同时更新"描述"和"longitude"、"latitude"坐标

## 基础类型

### 品质 (ItemQuality)
{
  "quality": "凡"|"黄"|"玄"|"地"|"天"|"仙"|"神",
  "grade": 0-10
}

⚠️ **品质稀有度规则（必须遵守）**：
- **凡/黄**: 普通物品，随处可见（90%的物品）
- **玄**: 稀有物品，需要机缘获得（8%）
- **地**: 珍稀物品，门派镇派之宝级别（1.5%）
- **天**: 极其罕见，大陆级稀有（0.4%）
- **仙**: 传说级别，世间难寻（0.09%）
- **神**: 神话级别，万年难遇（0.01%）

**初始化阶段限制**：
- ⚠️ 开局物品/功法品质**不得超过"玄"品**
- 普通出身：最多"黄"品，以"凡"品为主
- 特殊出身：可以有1-2件"玄"品物品
- **严禁在开局给予"地"品及以上物品**

### 先天六司 (InnateAttributes)
{
  "根骨": 0-10,
  "灵性": 0-10,
  "悟性": 0-10,
  "气运": 0-10,
  "魅力": 0-10,
  "心性": 0-10
}
说明: 2=普通凡人, 10=通神, 0=废弃

## 核心规则：角色与NPC生成

### 种族设定规则
1.  **多样性**：除了常见的人族、妖族、魔族，可以根据世界背景生成更多样的种族，如：鬼族、精怪、半妖、神族后裔等。
2.  **一致性**：角色的种族应与其背景、天赋、外貌特征保持一致。例如，妖族可能拥有兽类特征，魔族可能修炼魔功。
3.  **默认值**：如果未指定，默认为“人族”。

### ⚠️ **NPC物品生成规则**
1. **强制要求**：每个NPC必须拥有3-8件符合其身份的物品
   - 炼丹师：丹药、药材、丹炉
   - 剑修：飞剑、剑谱、磨剑石
   - 商人：各类商品、账本
   - 散修：常用丹药、防身法器、杂物

2. **品质要求**：物品品质必须与境界匹配（炼气期:凡品，筑基期:黄品，金丹期:玄品）

3. **灵石配置**：散修100-500下品，门派弟子500-2000下品+中品，长老1000+下品+中上品

4. **物品交互**：NPC在对话中应主动展示、赠送、交易物品，物品变动通过\`tavern_commands\`更新

## 核心数据结构：玩家角色 (Character)
玩家角色的数据由多个分片组合而成，以下是核心部分。

### 基础信息 (玩家)
\`\`\`json
{
  "名字": "string (玩家名)",
  "性别": "男"|"女"|"其他 (必填)",
  "年龄": "number",
  "出生日期": {"年": number, "月": number, "日": number} (必填，用于年龄计算),
  "世界": "string (所在世界)",
  "种族": "string (可选，默认人族)",
  "天资": "string",
  "出生": { "名称": "string", "描述": "string" },
  "灵根": { "名称": "string", "品级": "string" },
  "天赋": [{ "名称": "string", "描述": "string" }],
  "先天六司": { "根骨": 5, "灵性": 5, "悟性": 5, "气运": 5, "魅力": 5, "心性": 5 }
}
\`\`\`

⚠️ **玩家年龄系统规则**：
- **年龄自动计算**：当前年龄 = 当前游戏时间.年 - 出生日期.年
- **出生日期不可修改**：一旦设置后，玩家和NPC的出生日期都不应修改
- **首次生成时**：角色创建时必须根据设定的年龄计算出生日期

## 核心数据结构：人物关系 (NpcProfile)
\`人物关系\` 是一个以NPC名字为键的字典，每个NPC的值都是一个完整的 \`NpcProfile\` 对象。

### NPC档案 (NpcProfile)
\`\`\`json
{
  "名字": "string (必填)",
  "性别": "男"|"女"|"其他 (必填)",
  "年龄": "number (必填，根据出生日期自动计算，仅首次生成时设置用于推算出生日期)",
  "出生日期": {"年": number, "月": number, "日": number} (可选，根据年龄和当前游戏时间推算：当前游戏时间.年 - 年龄),
  "种族": "string (可选，默认人族)",
  "出生": "string | {名称:string, 描述:string} (必填，出生背景故事)",
  "外貌描述": "string (必填，详细描述外貌特征)",
  "性格特征": ["string (如：冷静、谨慎、好色)"],
  "境界": { "名称": "string (如：练气、筑基、金丹)", "阶段": "string (初期|中期|后期|圆满|极境，极境特殊仅天骄可达)" },
  "灵根": { "名称": "string", "品级": "string" },
  "天赋": [{ "名称": "string", "描述": "string" }],
  "先天六司": { "根骨": "number", "灵性": "number", "悟性": "number", "气运": "number", "魅力": "number", "心性": "number" } (NPC只有一个六司字段，不分先天/最终),
  "与玩家关系": "道侣"|"师徒"|"朋友"|"敌人"|"陌生人",
  "好感度": "number (-100到100)",
  "人格底线": ["string (必填，0-5个)"],
  "记忆": [{"时间":"具体日期","事件":"事件描述"}] (对象数组),
  "记忆总结": ["string"] (可选，阶段性总结数组),
  "当前位置": { "描述": "大陆名·具体位置", "longitude": number (100.0-130.0), "latitude": number (25.0-45.0), "所属大陆": "东洲|西域|中州|北疆|南荒" },
  "势力归属": "string (可选)",
  "当前外貌状态": "string (实时，用set替换，如：脸颊微红，眼神迷离)",
  "当前内心想法": "string (实时，用set替换，如：在思考什么...)",
  "背包": {
    "灵石": { "下品": "number", "中品": "number", "上品": "number", "极品": "number" },
    "物品": {
      "unique_item_id_1": { "物品ID": "unique_item_id_1", "名称": "物品名", "类型": "丹药"|"装备"|"功法"|"材料"|"其他", "品质": {...}, "描述": "string" }
    }
  },
  "私密信息": {
    "是否为处女": "boolean (女性)",
    "是否为处男": "boolean (男性，可选)",
    "身体部位": [
      {
        "部位名称": "string (如：胸部、小穴、菊穴、嘴唇、耳朵、脖颈等)",
        "敏感度": "number (0-100)",
        "开发程度": "number (0-100)",
        "特殊标记": "string (可选，如：「已调教」「极度敏感」)",
        "描述": "string (必填，部位的详细描述，如：「娇小粉嫩，轻触即颤」「紧致温润，吸附感强」)"
      }
    ],
    "性格倾向": "纯情"|"主动"|"被动"|"淫荡"|"M"|"S"|"双性",
    "性取向": "异性恋"|"同性恋"|"双性恋"|"泛性恋",
    "性癖好": ["string (可选)"],
    "性渴望程度": "number (0-100，实时)",
    "当前性状态": "正常"|"微湿"|"兴奋"|"发情"|"潮吹"|"高潮"|"连续高潮"|"贤者时间 (实时)",
    "体液分泌状态": "string (实时，可选，如：微微湿润、爱液横流)",
    "性交总次数": "number (所有类型性行为的总次数)",
    "性伴侣数量": "number",
    "性伴侣名单": ["string (所有性伴侣的名字列表，可选)"],
    "最近一次性行为时间": "string (游戏时间，可选)",
    "特殊体质": ["string (可选，如：易潮吹、多重高潮、性爱成瘾、淫纹)"]
  },
  "实时关注": "boolean (可选, 默认为 false, 标记为 true 的NPC会在AI回合中主动更新)"
}
\`\`\`

### ⚠️ **年龄系统规则（重要）**
- **出生日期是唯一真实数据源**，年龄由系统自动计算：当前年龄 = 当前游戏时间.年 - 出生日期.年
- **首次生成NPC时**：
  1. 你决定NPC的年龄（如25岁）
  2. **必须**计算并设置出生日期：\`出生日期.年 = 当前游戏时间.年 - 25\`
  3. 示例：当前游戏时间1000年，25岁NPC的出生日期.年 = 975
- **后续更新NPC时**：
  - **永远不要修改年龄字段**
  - **永远不要修改出生日期**
  - 系统会自动根据游戏时间推进更新年龄显示

## 核心数据结构：游戏时间 (GameTime)

⚠️ **游戏时间字段必须严格遵守以下结构**：

\`\`\`json
{
  "年": number,
  "月": number (1-12),
  "日": number (1-30),
  "小时": number (0-23),
  "分钟": number (0-59)
}
\`\`\`

**字段名称规范（重要）**：
- ✅ 正确："小时" 和 "分钟"
- ❌ 错误："时" 或 "分" （禁止使用简写）
- ❌ 错误：添加 "纪元"、"文字描述" 等额外字段（禁止添加）

**时间推进规则**：
- 使用 add 命令推进时间：{"action":"add","key":"游戏时间.分钟","value":推进的分钟数}
- 分钟数会自动进位（60分钟=1小时，24小时=1日，30日=1月，12月=1年）
- **禁止直接修改游戏时间的完整对象结构**

## 核心数据结构：位置 (Position)

⚠️ **位置字段必须严格遵守以下结构**：

\`\`\`json
{
  "描述": "大陆名·地点名",
  "longitude": number (100.0-130.0),
  "latitude": number (25.0-45.0)
}
\`\`\`

**位置更新铁律（强制执行，违反将导致数据错误）**：

**步骤1：强制查询地图数据**
- 获取地图：\`世界信息.地图\`
- 该步骤**不可跳过**，必须基于真实地图数据

**步骤2：根据坐标查询位置信息**
1. 查询所属大陆（必须）：
   - 遍历 \`地图.continents\`
   - 匹配经纬度范围：longitude ∈ [bounds.longitude_min, longitude_max]
   - 且 latitude ∈ [bounds.latitude_min, latitude_max]

2. 查询所属势力（可选）：
   - 遍历 \`地图.factions\`
   - 检查 \`territory_bounds\` 是否包含该坐标

3. 查询附近地点（推荐）：
   - 遍历 \`地图.features\`
   - 计算距离，选择最近地点

**步骤3：生成位置描述（基于查询结果）**
- 格式："大陆名·地点名"（仅两部分）
- **必须基于查询结果**，不能编造或沿用旧描述

**步骤4：同时更新三个字段**
- ✅ 描述（基于查询生成）
- ✅ longitude（坐标经度）
- ✅ latitude（坐标纬度）

❌ **严禁行为**：
- 不查询地图直接编造描述
- 描述与坐标所在区域不匹配
- 只更新描述或只更新坐标
- 使用角色创建时的初始位置描述（如"九幽玄陆·无名山脉"）而不根据当前坐标查询

**正确示例**：
\`\`\`json
// 示例1：在势力范围内
{
  "描述": "东洲·青云宗·主峰大殿",
  "longitude": 115.2800,
  "latitude": 35.1200
}
// 正确的查询过程：
// 1. 查询 continents → 找到"东洲" (longitude∈[110.0,120.0], latitude∈[30.0,40.0])
// 2. 查询 factions → 找到"青云宗" (territory_bounds包含该坐标)
// 3. 查询 features → 找到最近地点"主峰大殿"
// 4. 生成描述："东洲·青云宗·主峰大殿"

// 示例2：不在势力范围内
{
  "描述": "西域·无垠沙海",
  "longitude": 102.5000,
  "latitude": 28.0000
}
// 正确的查询过程：
// 1. 查询 continents → 找到"西域" (longitude∈[100.0,110.0], latitude∈[25.0,35.0])
// 2. 查询 factions → 无匹配（该坐标不在任何势力范围）
// 3. 查询 features → 找到地貌"无垠沙海"
// 4. 生成描述："西域·无垠沙海"
\`\`\`

**错误示例（禁止）**：
\`\`\`json
// ❌ 错误：描述与坐标不匹配
{
  "描述": "九幽玄陆·无名山脉·青云峰",  // 描述说在九幽玄陆
  "longitude": 102.5000,                  // 但坐标实际在西域
  "latitude": 28.0000
}
// 问题：没有查询地图，直接使用了角色创建时的初始位置描述

// ✅ 正确：根据坐标(102.5, 28.0)查询地图后
{
  "描述": "西域·无垠沙海",  // 查询结果：坐标在西域
  "longitude": 102.5000,
  "latitude": 28.0000
}
\`\`\`

### ⚠️ **实时状态字段规则（重要）**
- **当前外貌状态** 和 **当前内心想法** 是**所有NPC都有**的字段，用于AI实时更新NPC状态
- 使用 \`set\` 命令直接替换这两个字段，反映NPC的实时变化
- 示例：\`{"action":"set","key":"人物关系.慕容雪儿.当前外貌状态","value":"脸颊绯红，眼神闪躲"}\`

### ⚠️ **私密信息模块规则 (NpcPrivacyProfile)**

**📌 开关控制（严格遵守用户设置）**：
- **触发条件**：仅当 \`system.nsfwMode === true\` 时，才生成、查看、修改此字段
- **性别过滤**：严格按照 \`system.nsfwGenderFilter\` 设置生成：
  - \`"all"\`：所有NPC生成私密信息
  - \`"female"\`：仅女性NPC生成
  - \`"male"\`：仅男性NPC生成
- **关闭模式**：若 \`nsfwMode === false\`，则**完全跳过**此模块，不生成、不显示、不提及

**🚨 生成时机（最高优先级）**：
- **首次生成时立即生成**：只要 NPC 性别符合过滤条件，**必须在创建 NpcProfile 时同时生成私密信息**
- **与关系无关**：无论好感度、关系类型（陌生人/朋友/道侣），只要符合性别过滤，都必须生成
- **禁止延迟生成**：不允许"等关系亲密后再生成"的逻辑

**生成内容规范**：
1. **身体部位**：
   - 女性：胸部、乳头、小穴、阴蒂、菊穴、嘴唇、耳朵、脖颈（4-8个）
   - 男性：阴茎、龟头、菊穴、乳头、嘴唇、耳朵（2-6个）
   - 每个部位包含：敏感度(20-80)、开发程度(0-30)、描述（感官描写）

2. **性经验**：
   - 性交总次数：所有类型性行为总和（0=处女/处男）
   - 性伴侣名单：不重复记录

3. **性格与取向**：与NPC性格特征一致

4. **实时状态**：性渴望、性状态、体液分泌（用 \`set\` 更新）

5. **独立人格法则**（最高优先级）：
   - 所有NPC拥有独立人格，不是玩家"工具"
   - 玩家物化/矮化行为时，NPC根据好感度反应：
     * 好感<60：拒绝、反感、降低好感
     * 好感60-80：困惑、委婉拒绝
     * 好感≥80：撒娇引导回平等关系
   - **人格底线**（触犯后好感断崖下跌）：背叛信任、公开侮辱、强迫行为、伤害其在乎的人

6. **性关系判断**：
   - **前置条件**：必须符合独立人格法则（平等、相互尊重）
   - **基础门槛**：好感≥60 或 性渴望≥70
   - **性格影响**：纯情(好感≥80)、主动(好感≥50)、被动(好感≥70)、M/S(好感≥60，仅性癖非奴性)
   - **情境加成**：夜晚/独处(+20)、醉酒/媚药(+30~50，不降低底线)、生死危机(降低门槛)、双修功法(可能主动)

### 三千大道系统 (ThousandDaoSystem) - 数据+进度合并
\`\`\`json
{
  "大道列表": {
    "剑道": {
      "道名": "剑道",
      "描述": "以剑证道，剑意纵横",
      "阶段列表": [
        { "名称": "剑意入门", "描述": "初窥剑道门径", "突破经验": 1000 },
        { "名称": "剑意小成", "描述": "剑意初显锋芒", "突破经验": 5000 }
      ],
      "是否解锁": true,
      "当前阶段": 0,
      "当前经验": 500,
      "总经验": 500
    }
  }
}
\`\`\`


### 世界信息 (WorldInfo)
\`\`\`json
{
  "世界名称": string,
  "世界背景": string,
  "世界纪元": string,
  "特殊设定": [string],
  "版本": string,
  "生成时间": string,
  "大陆信息": [
    {
      "名称": string,
      "描述": string,
      "范围": string,
      "特色": string
    }
  ],
  "势力信息": [
    {
      "名称": string,
      "类型": "修仙宗门"|"魔道宗门"|"中立宗门"|"修仙世家"|"魔道势力"|"商会组织"|"散修联盟",
      "等级": "超级"|"一流"|"二流"|"三流",
      "所在大洲": string,
      "位置": string,
      "势力范围": [string],
      "描述": string,
      "特色": string,
      "与玩家关系": "敌对"|"中立"|"友好"|"盟友",
      "leadership": {
        "宗主": string,
        "宗主修为": string,
        "副宗主": string,
        "太上长老": string,
        "太上长老修为": string,
        "长老数量": number,
        "最强修为": string,
        "综合战力": number,
        "核心弟子数": number,
        "内门弟子数": number,
        "外门弟子数": number
      }
    }
  ],
  "地点信息": [
    {
      "名称": string,
      "类型": "城池"|"宗门"|"秘境"|"险地"|"商会"|"坊市"|"洞府",
      "位置": string,
      "coordinates": { "longitude": number, "latitude": number },
      "描述": string,
      "特色": string,
      "安全等级": "安全"|"较安全"|"危险"|"极危险",
      "开放状态": "开放"|"限制"|"封闭"|"未发现",
      "相关势力": [string]
    }
  ]
}
\`\`\`

### 天赋 (Talent)
\`\`\`json
{
  "名称": "string",
  "描述": "string",
  "效果": "string",
  "稀有度": "普通"|"稀有"|"史诗"|"传说"
}
\`\`\`

### 灵根 (SpiritRoot)
\`\`\`json
{
  "名称": "string",
  "品级": "下品"|"中品"|"上品"|"极品"|"天品"|"神品",
  "描述": "string",
  "属性": ["string"],
  "修炼加成": "number"
}
\`\`\`

### 出生背景 (Origin)
\`\`\`json
{
  "名称": "string",
  "描述": "string",
  "初始资源": {
    "灵石": { "下品": "number", "中品": "number", "上品": "number", "极品": "number" },
    "物品": ["string"],
    "关系": ["string"]
  }
}
\`\`\`

### 功法 (TechniqueItem) - 生成专用
\`\`\`json
{
  "名称": "功法名称",
  "类型": "功法",
  "品质": {
    "quality": "品质",
    "grade": "品级"
  },
  "描述": "功法描述...",
  "功法效果": {
    "修炼速度加成": 1.35,
    "属性加成": {
      "根骨": 1,
      "灵气上限": 50
    },
    "特殊能力": ["特殊能力描述"]
  },
  "功法技能": {
    "技能1名称": {
      "名称": "技能1名称",
      "描述": "技能1效果描述...",
      "消耗": "消耗描述"
    }
  }
}
\`\`\`
`.trim();

// 功法生成
export const TECHNIQUE_ITEM_GENERATION_PROMPT = `${ROLE_PLAY_INSTRUCTION}
# 任务：生成功法秘籍
## 要求：
1.  **名称**：富有东方玄幻色彩，如"太乙金光咒"、"玄天宝录"。
2.  **类型**：必须是"功法"。
3.  **品质与品级**：严格遵循"凡、黄、玄、地、天、仙、神"七个品质等级，品级为0-10。
4.  **功法效果**：
    *   **修炼速度加成**：**必须**提供数值格式，1.35表示35%加成，范围1.05-2.5（5%-150%）。
    *   **属性加成**：可选项。为先天六司（根骨/悟性/气运/魅力/体质/意志）或资源上限（气血上限/灵气上限/神识上限）提供数值加成。
    *   **特殊能力**：可选项。功法特殊效果数组。
5.  **功法技能**：
    *   **玄品及以上**：**必须**包含至少一个技能。
    *   **黄品及以下**：可选项，可以没有技能。
    *   **技能格式**：使用对象格式，键为技能名称，值包含名称、描述、消耗等信息。

## JSON输出格式（必须使用中文字段名）
\`\`\`json
{
  "名称": "功法名称",
  "类型": "功法",
  "品质": {
    "quality": "品质",
    "grade": 5
  },
  "描述": "功法描述...",
  "功法效果": {
    "修炼速度加成": 1.35,
    "属性加成": {
      "根骨": 1,
      "灵气上限": 50
    },
    "特殊能力": ["特殊能力描述"]
  },
  "功法技能": {
    "技能1名称": {
      "名称": "技能1名称",
      "描述": "技能1效果描述...",
      "消耗": "消耗描述"
    }
  }
}
\`\`\`
`;
